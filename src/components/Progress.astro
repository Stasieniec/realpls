---
interface Props {
  value: number; // 0-100 or 0-1
  max?: number;
  label?: string;
  showValue?: boolean;
  size?: 'sm' | 'md';
  variant?: 'default' | 'confidence';
}

const { 
  value, 
  max = 100, 
  label, 
  showValue = true,
  size = 'md',
  variant = 'default'
} = Astro.props;

const normalizedValue = max === 1 ? value * 100 : (value / max) * 100;
const displayValue = max === 1 ? `${Math.round(value * 100)}%` : `${Math.round(value)}%`;
---

<div class:list={['progress', `progress--${size}`, `progress--${variant}`]}>
  {label && <span class="progress-label">{label}</span>}
  <div class="progress-track" role="progressbar" aria-valuenow={normalizedValue} aria-valuemin="0" aria-valuemax="100">
    <div class="progress-fill" style={`width: ${normalizedValue}%`}></div>
  </div>
  {showValue && <span class="progress-value">{displayValue}</span>}
</div>

<style>
  .progress {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }
  
  .progress-label {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    flex-shrink: 0;
  }
  
  .progress-track {
    flex: 1;
    background: var(--color-bg-muted);
    border-radius: var(--radius-full);
    overflow: hidden;
  }
  
  .progress--sm .progress-track {
    height: 4px;
  }
  
  .progress--md .progress-track {
    height: 8px;
  }
  
  .progress-fill {
    height: 100%;
    background: var(--color-accent);
    border-radius: var(--radius-full);
    transition: width var(--transition-slow);
  }
  
  .progress--confidence .progress-fill {
    background: linear-gradient(90deg, var(--color-fail) 0%, var(--color-warn) 50%, var(--color-ok) 100%);
    background-size: 300% 100%;
    background-position: calc(100% - var(--progress-percent, 50%) * 1%) 0;
  }
  
  .progress-value {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-text-secondary);
    font-family: var(--font-mono);
    min-width: 3ch;
    text-align: right;
  }
</style>

